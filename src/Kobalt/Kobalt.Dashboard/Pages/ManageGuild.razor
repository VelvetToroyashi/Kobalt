@page "/manage/{GuildID:long}"
@using Remora.Discord.API.Abstractions.Objects
@using Kobalt.Dashboard.Components
@using Humanizer
@layout DashboardLayout

@if (_guildState is GuildState.Unavailable)
{
    <ProblemView Message="Oh boy.">
        <MudText Typo="Typo.h5" Align="Align.Center">
            Looks like that guild either isn't available or the request failed. <br/>
            Refresh the page or try a different guild id.
        </MudText>
    </ProblemView>
}
else if (_guildState is GuildState.Loading)
{
    <MudContainer Style="align-items: center" MaxWidth="MaxWidth.Medium">
        <MudText Typo="Typo.h4">Loading some additional information...</MudText>
        <MudProgressLinear Color="Color.Tertiary" Indeterminate="true" Size="Size.Large" />
    </MudContainer>
}
else
{
    <MudText Typo="Typo.h3">Overview of @(_guild!.Name)</MudText>
    <div style="margin-top: 20px"></div>
    <MudGrid>
        <MudItem>
            <MudCard Width="240px" Height="240px" Elevation="10" Square="true">
                <MudCardContent>
                    <MudText Typo="Typo.h5">Basic Info</MudText>
                    
                    <MudGrid Class="mt-3">
                        <MudItem>
                            <span style="color: dimgrey;">Members:</span>
                            <span class="font-bold">@(_guild?.ApproximateMemberCount.Map(c => c.ToMetric()).OrDefault("Unknown"))</span>
                        </MudItem>
                        <MudItem>
                            <span style="color: dimgrey;">Channels:</span>
                            <span class="font-bold">@(_channels?.Count.ToString() ?? "")</span>
                        </MudItem>
                        <MudItem>
                            <span style="color: dimgray">Logging channels:</span>
                            <span class="font-bold">@(_kobaltGuild?.LogChannels.Count ?? 0)</span>
                        </MudItem>
                    </MudGrid>
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem>
            <MudCard>
                <MudCardContent>
                    <MudText Typo="Typo.h5" GutterBottom="true">Recent Actions</MudText>
                    
                    
                    @if (!_infractions?.IsSuccess ?? false)
                    {
                        <MudAlert Severity="Severity.Warning" ContentAlignment="HorizontalAlignment.Center">
                            Failed to fetch recent actions.
                        </MudAlert>
                    }
                    else if (_infractions is { IsSuccess: true, Entity: [] })
                    {
                        <MudAlert Severity="Severity.Success" ContentAlignment="HorizontalAlignment.Center">
                            No recent actions.
                        </MudAlert>
                    }
                    else
                    {
                        <MudTable T="InfractionView" ReadOnly="true" Items="@(_infractions?.Entity ?? Array.Empty<InfractionView>())" Loading="@(_infractions is null)">
                            <HeaderContent>
                                <MudTh>Type</MudTh>
                                <MudTh>Enforcer</MudTh>
                                <MudTh>Target</MudTh>
                                <MudTh>Created</MudTh>
                                <MudTh>Expires</MudTh>
                                <MudTh>Reason</MudTh>
                            </HeaderContent>
                            <RowTemplate>
                                <MudTd DataLabel="Type">@context.Type</MudTd>
                                <MudTd DataLabel="Enforcer">@context.Enforcer</MudTd>
                                <MudTd DataLabel="Target">@context.Target</MudTd>
                                <MudTd DataLabel="Created">@context.When.Humanize()</MudTd>
                                <MudTd DataLabel="Expires">@(@context.Expiration?.Humanize() ?? "Never")</MudTd>
                                <MudTd DataLabel="Reason">@context.Reason</MudTd>
                            </RowTemplate>
                        </MudTable>
                    }
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
}